<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>Video Timeline</title>
<script src="jquery.js" type="text/javascript"></script>
<script src="popup.js" type="text/javascript"></script>
<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js" type="text/javascript" charset="utf-8"></script>-->
<script src="jquery.mousewheel.js" type="text/javascript" charset="utf-8"></script>
<script type='text/javascript'>
  function init_timeline(timeline, navmenu){
    $.ajax({
      url: '../api/videos.php?mode=list&limited=1',
      type: 'get',
      success: function(data){
        var tcats = JSON.parse(data);
        for( var tcat_id in tcats ){
          var tcat = add_tcat(timeline, tcats[tcat_id]);
        }
        init_event_handlers();
      }
    });
  }


  function init_expand_trigger(tcat, tcat_id, tcat_nav){
    $(tcat_nav).click(function(){
	if(true)
	{
		expand_tcat(tcat, tcat_id);
	}
	else
	{
		unexpand_tcat(tcat, tcat_id);
	}
    });
  }

/*
  function unexpand_tcat(tcat, tcat_id){
    var content = tcat.getElementsByTagName("div")[0];
    $.ajax({
      url: '../api/videos.php?mode=list&limited=1',
      type: 'get',
      success: function(data){
        while(content.firstChild){
          content.removeChild(content.firstChild);
        }
        var tcat_data = JSON.parse(data);
        var container;
        for(var i = 0; i < tcat_data[tcat_id]["members"].length; i++){
          if(i % 4 == 0) container = add_video_container(content);
          add_video(container, tcat_data[tcat_id]["members"][i]);
        }
		}
		});
	}

*/

  function expand_tcat(tcat, tcat_id){
    //var details = tcat.getElementsByTagName("div")[0];
    var content = tcat.getElementsByTagName("div")[0];
    $.ajax({
      url: '../api/videos.php?mode=list&scope='+tcat_id,
      type: 'get',
      success: function(data){
        //$(details).show();
        while(content.firstChild){
          content.removeChild(content.firstChild);
        }
        var tcat_data = JSON.parse(data);
        var container;
        for(var i = 0; i < tcat_data[tcat_id]["members"].length; i++){
          if(i % 4 == 0) container = add_video_container(content);
          add_video(container, tcat_data[tcat_id]["members"][i]);
        }

	$('.video').click(function() {
      var id = $(this).attr('id');
      $.ajax({
        url: 'timeline-relatedvideos.php',
        type: 'post',
        data:{id: id},
        success: function(value){
          $('#popup').html(value);
          //centers popup
          centerPopup();
          //loads popup
          loadPopup(id);
        }
      });
	});		
      }
    });
  }

  function init_event_handlers(){
    //CODE TO MAKE TIMELINE SCROLLABLE
    $('#timeline').mousedown(function (event) {
      $(this)
        .data('down', true)
        .data('x', event.clientX)
        .data('scrollLeft', this.scrollLeft);
            
        return false;
    }).mouseup(function (event) {
      $(this).data('down', false);
    }).mousemove(function (event) {
      if ($(this).data('down') == true) {
        this.scrollLeft = $(this).data('scrollLeft') + $(this).data('x') - event.clientX;
      }
    // Mousewheel does not always seem to work - SL
    }).mousewheel(function (event, delta) {
        this.scrollLeft -= (delta * 30);
    }).css({
        'overflow' : 'hidden',
        'cursor' : '-moz-grab'
    });
    
    $(window).mouseout(function (event) {
      if ($('#timeline').data('down')) {
        try {
          if (event.originalTarget.nodeName == 'BODY' || event.originalTarget.nodeName == 'HTML') {
            $('#timeline').data('down', false);
          }                
        } catch (e) {}
      }
    });

    /**
    //CLICK ON YEAR TO EXPAND
    $('#access li').click(function() {
      var index = $(this).index();
      if ( $('#test li:eq(' + index + ')').width() == 1200 ){
        $('#test li:eq(' + index + ')').animate({'width': '300px'});
        $(this).animate({'width': '300px'})
        $('#test li .details').hide();
      }else{
        $('#test li:eq(' + index + ')').animate({'width': '1200px'}, "slow").siblings().animate({'width':'300px'});
        $(this).animate({'width': '1200px'}).siblings().animate({'width':'300px'});
        $('#test li:eq(' + index + ') .details').show();
      }
    });
	
    //CLICK ON YEAR TO SCROLL TO THAT YEAR
    $('#access li').bind('click',function(event){
    	var $anchor = $(this);
    	$('html, body').stop().animate({scrollLeft: $($anchor.attr('a href')).position().left}, 1000);
    	event.preventDefault();
  	});
    **/

	$('.video').click(function() {
      var id = $(this).attr('id');
      $.ajax({
        url: 'timeline-relatedvideos.php',
        type: 'post',
        data:{id: id},
        success: function(value){
          $('#popup').html(value);
          //centers popup
          centerPopup();
          //loads popup
          loadPopup(id);
        }
      });
	});		
    //CLOSING POPUP
    //Click the x event
    $("#popupContactClose").click(function(){
      disablePopup();
    });
    //Click out event
    $("#backgroundPopup").click(function(){
      disablePopup();
    });
    //Press Escape event
    $(document).keypress(function(e){
      if(e.keyCode==27 && popupStatus==1){
        disablePopup();
      }
    });
  }

  function add_tcat(timeline, tcat_data){
    var tcat = document.createElement('li');
    tcat.setAttribute('id', 'tcat_'+tcat_data['id']);
    timeline.appendChild(tcat);
    // Title
    var title = document.createElement('h3');
    if(tcat_data['link'] != ""){
      var title_link = document.createElement("a");
      title_link.setAttribute("href", tcat_data["link"]);
      title_link.setAttribute("target","_blank");
      title_link.innerHTML = tcat_data["name"];
      title.appendChild(title_link);
    }else{
      title.innerHTML = tcat_data['name'];
    }
    tcat.appendChild(title);
    /* Details
    var details = document.createElement("div");
    details.setAttribute("class", "details");
    details.setAttribute("style", "display: none");
    if(tcat_data["description"] != ""){
      details.innerHTML = tcat_data["description"];
    }
    tcat.appendChild(details);
	*/
    // Content
    var content = document.createElement('div');
    tcat.appendChild(content);
    var container;
    for(var i = 0; i < tcat_data["members"].length; i++){
      if(i % 5 == 0) container = add_video_container(content);
      add_video(container, tcat_data.members[i]);
    }
	var timeline = document.createElement('div');
	timeline.setAttribute("class", "timeline-bar");
	tcat.appendChild(timeline);
    var link = document.createElement("a");
    link.setAttribute("href", "#tcat_"+tcat_data['id']);
    link.innerHTML = tcat_data['name_short'];
	timeline.appendChild(link);
	init_expand_trigger(tcat, tcat_data['id'], link);
    return tcat;
  }

  function add_video(container, video_data){
    var item = document.createElement("li");
    var video_container = document.createElement("div");
    video_container.setAttribute("class", "video_container");

    var video = document.createElement('img');
    video.setAttribute("class", "video");
    video.setAttribute("id", video_data.id);
    video.setAttribute("src", video_data.key_frame);
    video.setAttribute("width", "96");
    video.setAttribute("height", "72");

    var title = document.createElement("span");
    title.setAttribute("class", "title");
    title.innerHTML = video_data.title;

    var authors = document.createElement("span");
    authors.setAttribute("class", "authors");
    authors.innerHTML = video_data.authors;

    video_container.appendChild(video);
    video_container.appendChild(title);
    video_container.appendChild(document.createElement("br"));
    video_container.appendChild(authors);
    item.appendChild(video_container); 
   container.appendChild(item);
  }

  function add_video_container(content){
    var container = document.createElement("ul");
    container.setAttribute("class", "column");
    content.appendChild(container);
    return container;
  }

  function add_tcat_nav(navmenu, tcat_data){
    var nav = document.createElement("span");
    nav.setAttribute("id", "menu-item-"+tcat_data['id']);
    nav.setAttribute("class", "menu-item");
    var link = document.createElement("a");
    link.setAttribute("href", "#tcat_"+tcat_data['id']);
    link.innerHTML = tcat_data['name_short'];
    nav.appendChild(link);
    navmenu.appendChild(nav);
    return link;
  }

/*
  function add_tcat_nav(navmenu, tcat_data){
    var nav = document.createElement("li");
    nav.setAttribute("id", "menu-item-"+tcat_data['id']);
    nav.setAttribute("class", "menu-item");
    var link = document.createElement("a");
    link.setAttribute("href", "#tcat_"+tcat_data['id']);
    link.innerHTML = tcat_data['name_short'];
    nav.appendChild(link);
    navmenu.appendChild(nav);
    return link;
  }

*/

//Sends id of selected video to php script and returns information for popup.
  $(document).ready(function() {
    init_timeline(
      document.getElementById("test"),
      document.getElementById("menu-navigation-menu")
    );

//CODE TO MAKE NAVIGATION ARROWS WORK
	var slides = $('.tl-events li');
	var slideTotal = slides.length;
	var slideWidth = 350;
	var slideCurrent = 0;

	$('#timeline span').click(function() {
		if ($(this).attr('id') == 'next') {
			slideCurrent = slideCurrent + 1;
		}
		else {
			slideCurrent = slideCurrent - 1;
		}
		navigation(slideCurrent);

		// Move timeline.
		$('.tl-events').animate({
			'marginLeft' : (-slideCurrent * slideWidth)
		});
	});

	function navigation(slideCurrent) {
		//Hide previous-arrow when at the end.
		if ( slideTotal - 1 == slideCurrent) {
			$('#next').hide()
		}
		else {
			$('#next').show()
		}

		//Hide previous-arrow when at the beginning.
		if (slideCurrent == 0) {
			$('#previous').hide()
		}
		else {
			$('#previous').show()
		}
	}

	// Zorg ervoor dat de 'vorige' knop wordt weggelaten wanneer de pagina wordt geladen
	navigation(slideCurrent);
  });
</script>
<link rel="stylesheet" href="timeline-popup.css" type="text/css" media="screen" />

<!-- Helpers -->
<script src='../browser/helpers/inheritance.js'></script>
<script src='../browser/helpers/EventHelper.js'></script>
<script src="../browser/helpers/cookies.js"> </script>
<script src="../browser/helpers/fetchVideos.js"> </script>

<!-- Hierarchical models -->
<script src='../browser/models/fundamentals/View.js'></script>
<script src='../browser/models/fundamentals/Collection.js'></script>
<script src='../browser/models/fundamentals/CollectionFilter.js'></script>
<script src='../browser/models/fundamentals/Observable.js'></script>
  <script src='../browser/models/fundamentals/LayoutManager.js'></script>
  <script src='../browser/models/fundamentals/GraphicalGroup.js'></script>
  <script src='../browser/models/fundamentals/Layer.js'></script>
  <script src='../browser/models/fundamentals/Mouse.js'></script>
  <script src='../browser/models/fundamentals/Draggable.js'></script>
    <script src='../browser/models/fundamentals/Graphical.js'></script>
     <script src='../browser/models/fundamentals/Text.js'></script>
     <script src='../browser/models/fundamentals/GraphicalCoordinate.js'></script>
     <script src='../browser/models/fundamentals/ImageShape.js'></script>
      <script src='../browser/models/fundamentals/Shape.js'></script>
        <script src='../browser/models/fundamentals/Connection.js'></script>
        <script src='../browser/models/fundamentals/Arc.js'></script>
        <script src='../browser/models/fundamentals/Line.js'></script>
        <script src='../browser/models/fundamentals/Rectangle.js'></script>
          <script src='../browser/models/fundamentals/FilledRectangle.js'></script>

<!-- Object models -->
<script src='../browser/models/objects/Bin.js'></script>
<script src='../browser/models/objects/LinkedBin.js'></script>
<script src='../browser/models/objects/CircleFitting.js'></script>
<script src='../browser/models/objects/CircleFragment.js'></script>
<script src='../browser/models/objects/CircleFragmentBin.js'></script>
<script src='../browser/models/objects/Spiral.js'></script>
<script src='../browser/models/objects/ACMVideo.js'></script>
<script src='../browser/models/objects/APIConnection.js'></script>

<!-- Views -->
<script src='../browser/models/views/View1.js'></script>
<script src='../browser/models/views/CircleTestView.js'></script>
<script src='../browser/models/views/RelatednessCircleView.js'></script>


<!-- Application -->
<script src='../browser/ACMBrowserApp.js'></script>

</head>
<body>

<div id="timeline">
<div id="t_header">
	<a href="http://www.acm.org/" target="_blank"><img class="banner" src="images/acm_logo.png" /></a>
	<a href="http://www.sigmm.org/" target="_blank"><img class="banner" src="images/sigmm.jpg" /></a>
	<h1>Video Browser</h1>
</div>
    <span class="arrow previous" id="previous"></span>
    <span class="arrow next" id="next"></span>
  <ul class="tl-events" id="test">
  </ul>
  <!---Tijdlijnbar <div class="timeline-bar" style="width:100%;height:30px;">
  <div id="t_footer">
      <div id="access">
        <ul id="menu-navigation-menu" class="menu">
        </ul>
      </div>			
    </div>
  </div>--->
</div>

<!-- POPUP -->
<div id="popup">
</div>
</body>
</html>

